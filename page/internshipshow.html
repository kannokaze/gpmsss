<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>学生实习资料查看</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="icon" href="../images/logo-m.png">
    <link rel="stylesheet" href="../lib/layui-v2.5.4/css/layui.css" media="all">
    <link rel="stylesheet" href="../css/public.css" media="all">
    <link rel="stylesheet" href="../lib/font-awesome-4.7.0/css/font-awesome.min.css" media="all">
    <!--     <link rel="stylesheet" href="../lib/lay-module/step-lay/step.css" media="all"> -->
    <style>
        /* .required:after {content:'*';color:red;position:absolute;margin-left:4px;font-weight:bold;line-height:1.8em;top:6px;right:5px;} */
        .layui-disabled{}
        .listTimeBar{ text-align: right; }
    .layui-card {
        border: 1px solid #f2f2f2;
        border-radius: 5px;
    }
    </style>
</head>

<body>
    <input type="hidden" class="AstudentNo" name="AstudentNo">
    <input type="hidden" class="AstudentName" name="AstudentName">
    <div class="layuimini-container">
        <div class="layuimini-main">
            <!-- 实习生自我鉴定 -->
            <blockquote class="layui-elem-quote">实习生自我鉴定</blockquote>
            <div class="layui-card">
                <div class="layui-card-header">
                    <i class="layui-icon layui-icon-list icon"></i>自我鉴定
                    <!-- <button class="layui-btn" style="float:right;" id="new">新建日志</button> -->
                </div>
                <div class="layui-card-body">
                    <!-- 内容标题 -->
                    <div class="layui-form-item">
                        <label class="layui-form-label">内容</label>
                        <div class="layui-input-block">
                            <div class="layui-form-mid layui-word-aux selfcomment layui-text selfcomment">
                                学生未提交自我鉴定
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <blockquote class="layui-elem-quote">实习企业 </blockquote>
            <div class="layui-card">
                <div class="layui-card-header">
                    <i class="layui-icon layui-icon-list icon"></i>毕业实习企业信息
                    <!-- <button class="layui-btn" style="float:right;" id="new">新建日志</button> -->
                </div>
                <div class="layui-card-body">
                    <!-- 内容标题 -->
                    <div class="layui-form-item">
                        <label class="layui-form-label">实习企业号</label>
                        <div class="layui-input-block">
                            <div class="layui-form-mid layui-word-aux companyAcc"></div>
                        </div>
                    </div>
                    <div class="layui-form-item layui-form-text">
                        <label class="layui-form-label">实习企业名</label>
                        <div class="layui-input-block">
                            <div class="layui-form-mid layui-word-aux companyName"></div>
                        </div>
                    </div>
                    <div class="layui-form-item layui-form-text">
                        <label class="layui-form-label">负责人</label>
                        <div class="layui-input-block">
                            <div class="layui-form-mid layui-word-aux companyManager"></div>
                        </div>
                    </div>
                    <div class="layui-form-item layui-form-text">
                        <label class="layui-form-label">行业</label>
                        <div class="layui-input-block">
                            <div class="layui-form-mid layui-word-aux companyTrade"></div>
                        </div>
                    </div>
                </div>
            </div>
            <blockquote class="layui-elem-quote">实习项目内容</blockquote>
            <div class="layui-card">
                <div class="layui-card-header">
                    <i class="layui-icon layui-icon-list icon"></i>实习内容
                    <!-- <button class="layui-btn" style="float:right;" id="new">新建日志</button> -->
                </div>
                <div class="layui-card-body">
                    <!-- 内容标题 -->
                    <div class="layui-form-item">
                        <label class="layui-form-label">实习内容</label>
                        <div class="layui-input-block">
                            <div class="layui-form-mid layui-word-aux contname"></div>
                        </div>
                    </div>
                    <div class="layui-form-item layui-form-text">
                        <label class="layui-form-label">内容描述</label>
                        <div class="layui-input-block">
                            <div class="layui-form-mid layui-word-aux contc"></div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- 实习项目 -->
            <div class="layui-card">
                <div class="layui-card-header">
                    <i class="layui-icon layui-icon-list icon"></i>实习项目
                    <!-- <button class="layui-btn" style="float:right;" id="new">新建日志</button> -->
                </div>
                <div class="layui-card-body">
                    <table class="layui-table " id="projectTable" lay-filter="projectTable"></table>
                </div>
            </div>
            <!-- 实习团队 -->
            <div class="layui-card">
                <div class="layui-card-header">
                    <i class="layui-icon layui-icon-list icon"></i>项目团队成员
                    <!-- <button class="layui-btn" style="float:right;" id="new">新建日志</button> -->
                </div>
                <div class="layui-card-body">
                    <div class="layui-form-item teamBar">
                        <!-- <div class="layui-word-aux nothing"><i class="fa fa-arrow-up"></i>你没有提交信息哦，赶紧点击上面的按钮吧！</div> -->
                        <!-- table -->
                        <table class="layui-table" id="progressTable" lay-filter="progressTable"></table>
                    </div>
                </div>
            </div>
            <!-- 实习进展 -->
            <div class="layui-card">
                <div class="layui-card-header">
                    <i class="layui-icon layui-icon-list icon"></i>实习进展
                    <!-- <button class="layui-btn" style="float:right;" id="new">新建日志</button> -->
                </div>
                <div class="layui-card-body">
                    <div class="layui-form-item ProgressBar">
                        <!-- <div class="layui-word-aux nothing"><i class="fa fa-arrow-up"></i>你没有提交信息哦，赶紧点击上面的按钮吧！</div> -->
                        <!-- table -->
                        <table class="layui-table" id="progressTable" lay-filter="progressTable"></table>
                    </div>
                </div>
            </div>
            <div class="layui-col-sm12 right">
                <div class="layui-row">
                </div>
            </div>
            <blockquote class="layui-elem-quote">实习日志 </blockquote>
            <div class="layui-card">
                <div class="layui-card-header">
                    <i class="layui-icon layui-icon-list icon"></i>实习日志
                    <span class="layui-badge layui-bg-blue jcount">0篇</span>
                    <!-- <button class="layui-btn" style="float:right;" id="new">新建日志</button> -->
                </div>
                <div class="layui-card-body journal">
                    <!--  -->
                    <div class="layui-form-item">
                        <div class="layui-form-mid layui-word-aux journalContent">学生没有提交日志</div>
                        <div class="layui-form-item" style="background:#f4f5f7;border-radius: 8px;padding:15px;">
                            <h3 class="journalName">' + res.data[i].jourTitle + '</h3>
                            <div class="layui-block">
                                <div class="layui-form-mid layui-text journalContent">' + res.data[i].jourContent + '</div>
                                <hr class="layui-bg-green">
                                <div class="layui-form-item">
                                    <label class="layui-form-label">企业评分</label>
                                    <div class="layui-input-block">
                                        <div class="layui-form-mid layui-word-aux journalScore"></div>
                                    </div>
                                </div>
                                <div class="layui-form-item layui-form-text">
                                    <label class="layui-form-label">企业评价</label>
                                    <div class="layui-input-block">
                                        <div class="layui-form-mid layui-word-aux joutnalComment"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- 实习生自我鉴定 -->
                <blockquote class="layui-elem-quote">实习接收函</blockquote>
                <div class="layui-card">
                    <div class="layui-card-header">
                        <i class="layui-icon layui-icon-list icon"></i>实习接受函查看
                        <!-- <button class="layui-btn" style="float:right;" id="new">新建日志</button> -->
                    </div>
                    <div class="layui-card-body">
                        <!-- 内容标题 -->
                        <div class="layui-form-item">
                            <!-- <label class="layui-form-label">内容</label> -->
                            <div class="layui-input-block">
                                <div class="layui-form-mid ">
                                    <div class="layui-form-mid layui-word-aux accletip">学生没有提交实习接受函</div>
                                    <div class="perview" style="overflow: auto;">
                                        <img class="layui-upload-img" id="demo1" width="100%">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="../lib/layui-v2.5.4/layui.js" charset="utf-8"></script>
    <script src="../js/lay-config.js?v=1.0.4" charset="utf-8"></script>
    <script src="../js/public.js"></script>
    <script>
    layui.use(['form', 'step', 'element', 'table', 'laydate'], function() {
        var $ = layui.$,
            form = layui.form,
            step = layui.step,
            laydate = layui.laydate,
            table = layui.table,
            element = layui.element;

        var model;
        // var isTime = getConfigDeadline($('.listTimeBar'));
        $.ajax({
            url: gpms.host + "api/search/searchCompanyByStuNo",
            data: "stuNo=" + $('.AstudentNo').val(),
            type: "GET",
            xhrFields: { withCredentials: true },
            crossDomain: true,
            beforeSend: function(xhr) {
                index = layer.msg('加载中', {
                    icon: 16,
                    shade: 0.01
                });
            },
            success: function(res) {
                if (res.data.length == 0) {
                    $('.companyAcc').text("无实习企业");
                    $('.companyName').text("无实习企业");
                    $('.companyManager').text("无实习企业");
                    $('.companyTrade').text("无实习企业");
                    return;
                }

                $('.companyAcc').text(res.data[0].comAccount);
                $('.companyName').text(res.data[0].comName);
                $('.companyManager').text(res.data[0].comManager);
                $('.companyTrade').text(res.data[0].comTrade);
            },
            error: function(xhr, status, error) {
                layer.msg('接口返回异常', { icon: 5 });
            },
            complete: function(xhr, status) {
                layer.close(index);
            }
        })

        $.ajax({
            url: gpms.host + "api/search/searchJournal",
            data: "stuNo=" + $('.AstudentNo').val(),
            type: "GET",
            xhrFields: { withCredentials: true },
            crossDomain: true,
            beforeSend: function(xhr) {
                index = layer.msg('加载中', {
                    icon: 16,
                    shade: 0.01
                });
            },
            success: function(res) {
                $('.jcount').text(res.data.length + '篇')
                $('.journal').html('');
                var ss = '';
                for (var i = 0; i < res.data.length; i++) {
                    var jourScore = res.data[i].jourScore == null ? "" : res.data[i].jourScore;
                    var jourComment = res.data[i].jourComment == null ? "" : res.data[i].jourComment;
                    ss += '<div class="layui-form-item" style="background:#f4f5f7;border-radius: 8px;padding:15px;"><h3 class="journalName">' + res.data[i].jourTitle + '</h3><div class="layui-block" ><div class="layui-form-mid layui-text journalContent">' + res.data[i].jourContent + '</div><hr class="layui-bg-green"><div class="layui-form-item"><label class="layui-form-label">企业评分</label><div class="layui-input-block"><div class="layui-form-mid layui-word-aux journalScore">' + jourScore + '</div></div></div><div class="layui-form-item layui-form-text"><label class="layui-form-label">企业评价</label><div class="layui-input-block"><div class="layui-form-mid layui-word-aux joutnalComment">' + jourComment + ' </div></div></div></div></div>';

                    $('.journal').html(ss);
                }
            },
            error: function(xhr, status, error) {
                layer.msg('接口返回异常', { icon: 5 });
            },
            complete: function(xhr, status) {
                layer.close(index);
            }
        })

        $.ajax({
            url: gpms.host + "api/search/accltterByStuNo",
            type: "GET",
            data: "stuNo=" + $('.AstudentNo').val(),
            xhrFields: { withCredentials: true },
            crossDomain: true,
            beforeSend: function(xhr) {
                index = layer.msg('加载中', {
                    icon: 16,
                    shade: 0.01
                });
            },
            success: function(res) {
                if (res.data.length > 0) {
                    // $('#u1').addClass('layui-disabled');
                    // $('#u1').html('<div style="text-align:center;font-size:30px;">上传区域已关闭</div>');
                    // $('#u2').html('<i class="layui-icon layui-icon-picture icon pic"></i>我的实习接受函');
                    $('.accletip').remove();
                    $('#demo1').attr('src', gpms.downloadHost + res.data[0].lalRelativePath);
                }
            },
            error: function(xhr, status, error) {
                layer.msg('接口返回异常', { icon: 5 });
            },
            complete: function(xhr, status) {
                layer.close(index);
            }
        })

        // 页面开启查询有无实习内容相关
        function getContentProjectProgress() {
            var index;


            $.ajax({
                url: gpms.host + "api/search/internshipInfoByStuNo",
                type: "GET",
                data: "stuNo=" + $('.AstudentNo').val(),
                xhrFields: { withCredentials: true },
                crossDomain: true,
                beforeSend: function(xhr) {
                    index = layer.msg('加载中', {
                        icon: 16,
                        shade: 0.01
                    });
                },
                success: function(res) {
                    gpms.isLogin(res, function() {
                        if (res.data.length == 0 || res.data[0].lcName == null) {
                            layer.alert($('.AstudentName').val() + '还未提交实习内容信息', {
                                title: "提示",
                                skin: 'layui-layer-molv',
                                closeBtn: 0,
                                scrollbar: false,

                            });
                            $('.modify').text("开启添加");
                            model = "create";

                        } else {

                            // 将实习内容写入，页面初始化
                            $('.contname').text(res.data[0].lcName);
                            $('.contc').text(res.data[0].lcContent);
                            $('.selfcomment').text(res.data[0].lcSelfcomment == null ? "学生未提交自我鉴定" : res.data[0].lcSelfcomment);

                            // 将项目信息写入
                            table.render({
                                title: "项目信息",
                                elem: '#projectTable',
                                // width: 860,
                                // where: { stuName: '' },
                                data: res.data[0].projectList,
                                cols: [
                                    [
                                        // { type: "checkbox", width: 50, fixed: "left" },
                                        { field: 'proName', title: '项目名', sort: true },
                                        { field: 'teamName', title: '简介' },
                                        {
                                            field: 'd.team.teamName',
                                            title: '团队',
                                            templet: '<div>{{ d.team !== null?d.team.teamName:" "}}</div>',
                                        },

                                        { field: 'proComAcc', title: '企业' },
                                        { field: 'proStarttime', title: '开始时间', templet: function(d) { return dateFormat(d.proStarttime); } },
                                        { field: 'proEndtime', title: '结束时间', templet: function(d) { return dateFormat(d.proEndtime); } },
                                        // { title: '操作', minWidth: 100, templet: '#currentTableBar', fixed: "right", align: 'center', fixed: 'right' }
                                    ]
                                ],
                                done: function(res, curr, count) {},
                                cellMinWidth: 100,
                                limits: [10, 15, 20, 25, 50, 100],
                                limit: 10,
                                // page: true
                            });
                            // 将团队成员写入
                            getTeamMember(res.data[0].projectList)
                            // 将项目进展写入
                            getProgress(res.data[0].projectList)
                        }
                    });
                },
                error: function() {
                    layer.msg('接口返回异常', { icon: 5 });
                },
                complete: function(xhr, status) {
                    layer.close(index);
                }
            })

        }

        function getTeamMember(dataList) {
            var len = dataList.length;
            $('.teamBar').html('');
            for (var i = 0; i < len; i++) {
                if (dataList[i].team != null) {
                    $('select[name=teamSelect]').append('<option value="' + dataList[i].team.teamCode + '">' + dataList[i].team.teamName + '</option>');
                    form.render('select');
                    $('.teamBar').append("<h2>团队【" + dataList[i].team.teamName + "】的成员</h2");
                    $('.teamBar').append("<table id='TeamMemberTable" + i + "' lay-filter='TeamMemberTable" + i + "'></table");

                    table.render({
                        title: "项目成员信息",
                        elem: '#TeamMemberTable' + i,
                        // width: 860,
                        // where: { stuName: '' },
                        data: dataList[i].team.teamMemberList,
                        cols: [
                            [
                                { field: 'tmName', title: '成员名', sort: true },
                                { field: 'tmDuty', title: '职责' },
                                // { title: '操作', minWidth: 100, templet: '#currentTableBar', fixed: "right", align: 'center', fixed: 'right' }
                            ]
                        ],
                        done: function(res, curr, count) {

                        },
                        cellMinWidth: 100,
                        limits: [5, 10, 15, 20, 25, 30],
                        limit: 5,
                        // page: true
                    });

                }

            }
        }

        function getProgress(dataList) {
            var len = dataList.length;
            console.log(len)
            $('.ProgressBar').html('')
            for (var i = 0; i < len; i++) {
                $('.ProgressBar').append("<h2>【" + dataList[i].proName + "】进展</h2");
                $('.ProgressBar').append("<table id='progressTable" + i + "' lay-filter='progressTable" + i + "'></table");

                table.render({
                    title: "项目进展信息",
                    elem: '#progressTable' + i,
                    // width: 860,
                    // where: { stuName: '' },
                    data: dataList[i].progressList,
                    cols: [
                        [
                            // { type: "checkbox", width: 50, fixed: "left" },
                            { field: 'progName', title: '进展名称', sort: true },
                            { field: 'progDuty', title: '简介' },
                            { field: 'progStarttime', title: '开始时间', templet: function(d) { return dateFormat(d.progStarttime); } },
                            { field: 'progEndtime', title: '结束时间', templet: function(d) { return dateFormat(d.progEndtime); } },
                            // { title: '操作', minWidth: 30, templet: '#currentTableBar', fixed: "right", align: "center" }
                        ]
                    ],

                    done: function(res, curr, count) {},
                    cellMinWidth: 100,
                    limits: [5, 10, 15, 20, 25, 30],
                    limit: 5,
                    // page: true
                });
            }
        }


        // 获取项目
        getContentProjectProgress();

        $('.perview').on('click', function(even) {
            if ($('#demo1').attr('src')) {
                parent.layer.open({
                    type: 1,
                    title: false,
                    // closeBtn: 0,
                    area: ['600px'],
                    move: '.bigPic',
                    moveOut: true,
                    skin: 'layui-layer-nobg', //没有背景色
                    shade: 0.8,
                    shadeClose: true,
                    content: "<img class='bigPic' src=" + $('#demo1').attr('src') + " width='100%'>"
                });
            }
            event.stopPropagation();
        })
    })
    </script>
</body>

</html>