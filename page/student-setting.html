<!DOCTYPE html>
<html>

<head>
    <title>学生用户信息设定</title>
    <meta charset="utf-8">
    <link rel="icon" href="../images/logo-m.png">
    <link rel="stylesheet" href="../lib/layui-v2.5.4/css/layui.css" media="all">
    <link rel="stylesheet" href="../css/public.css" media="all">
    <style>
        /*body{ background: #fff; }*/
        .required:after {content:'*';color:red;position:absolute;margin-left:4px;font-weight:bold;line-height:1.8em;top:6px;right:5px;}
    </style>
</head>

<body>
    <div class="layuimini-container">
        <div class="layuimini-main ">
            <div class="" style="max-width: 725px;margin: 0 auto;">
                <blockquote class="layui-elem-quote">我的信息</blockquote>
                <!-- 添加专业及方向表单 -->
                <form class="layui-form" action="#" method="post" style="margin-right: 15px;">
                    <!-- 学生学号 -->
                    <div class="layui-form-item">
                        <label class="layui-form-label required">我的学号：</label>
                        <div class="layui-input-block">
                            <input type="text" name="stuNo" autocomplete="off" placeholder="我的学号" lay-verify="required" lay-reqtext="请输入你的学号哦！" class="layui-input layui-disabled" disabled="">
                        </div>
                    </div>
                    <!-- 学生姓名 -->
                    <div class="layui-form-item">
                        <label class="layui-form-label required">我的姓名：</label>
                        <div class="layui-input-block">
                            <input type="text" name="stuName" autocomplete="off" placeholder="我的姓名" lay-verify="required" lay-reqtext="请输入你的姓名哦！" class="layui-input">
                        </div>
                    </div>
                    <!--                 学生账户密码
<div class="layui-form-item">
    <label class="layui-form-label required">填写密码：</label>
    <div class="layui-input-block">
        <input type="password" name="key" autocomplete="off" placeholder="密码" lay-verify="required" lay-reqtext="请输入学生登录密码哦！" class="layui-input">
    </div>
</div>
再次确认
<div class="layui-form-item">
    <label class="layui-form-label required">确认密码：</label>
    <div class="layui-input-block">
        <input type="password" name="key" autocomplete="off" placeholder="确认密码" lay-verify="required" lay-reqtext="请确认密码哦！" class="layui-input">
    </div>
</div> -->
                    <!-- 填写手机号 -->
                    <div class="layui-form-item">
                        <label class="layui-form-label required">我的手机：</label>
                        <div class="layui-input-block">
                            <input type="text" name="stuPhone" autocomplete="off" placeholder="手机号码" lay-verify="required" lay-reqtext="请输入手机号码哦！" class="layui-input">
                        </div>
                    </div>
                    <!-- 填写邮箱地址 -->
                    <div class="layui-form-item">
                        <label class="layui-form-label required">我的邮箱：</label>
                        <div class="layui-input-block">
                            <input type="text" name="stuMail" autocomplete="off" placeholder="学生邮箱" lay-verify="required" lay-reqtext="请输入邮箱哦！" class="layui-input">
                        </div>
                    </div>
                    <!-- 填写住址 -->
                    <div class="layui-form-item">
                        <label class="layui-form-label required">我的住址：</label>
                        <div class="layui-input-block">
                            <input type="text" name="stuAdd" autocomplete="off" placeholder="联系地址" lay-verify="required" lay-reqtext="请输入住址哦！" class="layui-input">
                        </div>
                    </div>
                    <!--                     选择学生专业及方向和老师
<div class="layui-form-item">
    <label class="layui-form-label required">专业/方向/指导老师：</label>
    <div class="layui-input-inline">
        <select name="major" id="major" lay-filter="major" lay-verify="required">
            <option value="">请选泽专业</option>
        </select>
    </div>
    <div class="layui-input-inline">
        <select name="direction" id="direction" lay-filter="direction" lay-verify="required">
            <option value="">请选择方向</option>
        </select>
    </div>
    <div class="layui-input-inline">
        <select name="teacher" id="teacher" lay-filter="teacher" lay-verify="required">
            <option value="">请选择指导老师：</option>
        </select>
    </div>
</div>
选择毕业行政班
<div class="layui-form-item">
    <label class="layui-form-label required">毕业行政班： </label>
    <div class="layui-input-inline">
        <select name="modules" lay-verify="required" lay-search="">
            <option value="">直接选择或搜索选择</option>
        </select>
    </div>
    <div class="layui-form-mid layui-word-aux">请勿选择错误，关系你的实习结果</div>
</div> -->
                    <!-- 表单信息提交或者重置 -->
                    <div class="layui-form-item">
                        <div class="layui-input-block">
                            <button type="submit" class="layui-btn" lay-submit="" lay-filter="demo1">提交修改</button>
                            <button type="button" class="layui-btn layui-btn-primary reset">重置</button>
                        </div>
                    </div>
                </form>
                <hr>
                <div style="color: #666;margin-top: 30px;margin-bottom: 30px;padding-left: 30px;">
                    <h3>说明</h3>
                    <h4>（1）带<i style="color:red;font-size: 20px;line-height:14px;vertical-align: center">*</i>的为必填项</h4>
                    <p>（2）填写的邮箱将用于通知和验证等用途，请认真填写！</p>
                    <p>（3）建议没有问题不要轻易修改 </p>
                    <p>（4）修改信息时有什么问题可以联系管理员</p>
                </div>
            </div>
        </div>
    </div>
</body>
<script src="../lib/layui-v2.5.4/layui.js" charset="utf-8"></script>
<script src="../js/province.js"></script>
<script src="../js/public.js"></script>
<script>
layui.use(['form', 'table'], function() {
    var form = layui.form,
        $ = layui.$,
        table = layui.table,
        $form = $('form');


    // 获取信息展示
    $('.reset').on('click', function() {
        $.ajax({
            url: gpms.host + "api/stu/myInfoInStu",
            type: "GET",
            xhrFields: { withCredentials: true },
            crossDomain: true,
            async: false,
            beforeSend: function(xhr) {
                index = layer.msg('加载中', {
                    icon: 16,
                    shade: 0.01
                });
            },
            success: function(res) {
                if (res.data.length) {
                    $('input[name="stuNo"]').val(res.data[0].stuNo);
                    $('input[name="stuName"]').val(res.data[0].stuName);
                    $('input[name="stuPhone"]').val(res.data[0].stuPhone);
                    $('input[name="stuMail"]').val(res.data[0].stuEmail);
                    $('input[name="stuAdd"]').val(res.data[0].stuAddress);
                    $('select[name="major"]').html("<option value=" + +">" + +"</option>");
                    $('select[name="direction"]').html("<option value=" + +">" + +"</option>");
                    $('select[name="teacher"]').html("<option value=" + +">" + +"</option>");
                }

            },
            error: function() {
                layer.msg('接口返回异常', { icon: 5 });
            },
            complete: function(xhr, status) {
                layer.close(index);
            }
        })
    }).trigger('click');


    form.verify({
        title: function(value) {
            if (value.length < 5) {
                return '标题至少得5个字符啊';
            }
        },
        pass: [
            /^[\S]{6,12}$/, '密码必须6到12位，且不能出现空格'
        ],
        content: function(value) {
            layedit.sync(editIndex);
        }
    });



    //监听提交
    form.on('submit(demo1)', function(data) {
        var myInfo = data.field;
        layer.confirm('确定修改吗', { title: '提示' }, function() {
            $.ajax({
                url: gpms.host + "api/stu/modifyMyInfo",
                type: "POST",
                data: 'stuNo=' + myInfo.stuNo + "&stuName=" + myInfo.stuName + "&stuPhone=" + myInfo.stuPhone + "&stuEmail=" + myInfo.stuMail + "&stuAdd=" + myInfo.stuAddress,
                xhrFields: { withCredentials: true },
                crossDomain: true,
                beforeSend: function(xhr) {
                    index = layer.msg('加载中', {
                        icon: 16,
                        shade: 0.01
                    });
                },
                success: function(res) {
                    if (res.code == "0") {
                        layer.msg(res.msg, { icon: 1 })
                    }else{
                        layer.msg(res.msg, { icon: 5 })
                    }
                },
                error: function(xhr, status, error) {
                    layer.msg('接口返回异常', { icon: 5 });
                },
                complete: function(xhr, status) {
                    layer.close(index);
                }
            })
        })

        return false;
    });


});
</script>

</html>